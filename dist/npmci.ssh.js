"use strict";
require("typings-global");
var plugins = require("./npmci.plugins");
var sshRegex = /^(.*)\|?(.*)\|?(.*)/;
var sshInstance;
exports.ssh = function () {
    sshInstance = new plugins.smartssh.SshInstance();
    plugins.smartparam.forEachMinimatch(process.env, "NPMCI_SSHKEY_*", exports.evaluateSshkey);
    sshInstance.writeToDisk();
};
exports.evaluateSshkey = function (sshkeyEnvVarArg) {
    var resultArray = sshRegex.exec(sshkeyEnvVarArg);
    var sshKey = new plugins.smartssh.SshKey();
    if (resultArray[1] && resultArray[1] != "undefined")
        sshKey.privKeyBase64 = resultArray[1];
    var publicKey;
    if (resultArray[2] && resultArray[2] != "undefined")
        sshKey.pubKeyBase64 = resultArray[2];
    var host;
    if (resultArray[3] && resultArray[3] != "undefined")
        sshKey.host = resultArray[1];
    sshInstance.addKey(sshKey);
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5wbWNpLnNzaC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsUUFBTyxnQkFBZ0IsQ0FBQyxDQUFBO0FBQ3hCLElBQVksT0FBTyxXQUFNLGlCQUFpQixDQUFDLENBQUE7QUFFM0MsSUFBSSxRQUFRLEdBQUcscUJBQXFCLENBQUE7QUFDcEMsSUFBSSxXQUF3QyxDQUFDO0FBRWxDLFdBQUcsR0FBRztJQUNiLFdBQVcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDakQsT0FBTyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFDLGdCQUFnQixFQUFDLHNCQUFjLENBQUMsQ0FBQztJQUNqRixXQUFXLENBQUMsV0FBVyxFQUFFLENBQUM7QUFDOUIsQ0FBQyxDQUFDO0FBRVMsc0JBQWMsR0FBRyxVQUFDLGVBQWU7SUFDeEMsSUFBSSxXQUFXLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUNqRCxJQUFJLE1BQU0sR0FBRyxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7SUFFM0MsRUFBRSxDQUFBLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxXQUFXLENBQUM7UUFBQyxNQUFNLENBQUMsYUFBYSxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMxRixJQUFJLFNBQWdCLENBQUM7SUFDckIsRUFBRSxDQUFBLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxXQUFXLENBQUM7UUFBQyxNQUFNLENBQUMsWUFBWSxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6RixJQUFJLElBQVcsQ0FBQztJQUNoQixFQUFFLENBQUEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLFdBQVcsQ0FBQztRQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRWpGLFdBQVcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDL0IsQ0FBQyxDQUFDIiwiZmlsZSI6Im5wbWNpLnNzaC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBcInR5cGluZ3MtZ2xvYmFsXCI7XG5pbXBvcnQgKiBhcyBwbHVnaW5zIGZyb20gXCIuL25wbWNpLnBsdWdpbnNcIjtcblxubGV0IHNzaFJlZ2V4ID0gL14oLiopXFx8PyguKilcXHw/KC4qKS9cbmxldCBzc2hJbnN0YW5jZTpwbHVnaW5zLnNtYXJ0c3NoLlNzaEluc3RhbmNlO1xuXG5leHBvcnQgbGV0IHNzaCA9ICgpID0+IHtcbiAgICBzc2hJbnN0YW5jZSA9IG5ldyBwbHVnaW5zLnNtYXJ0c3NoLlNzaEluc3RhbmNlKCk7XG4gICAgcGx1Z2lucy5zbWFydHBhcmFtLmZvckVhY2hNaW5pbWF0Y2gocHJvY2Vzcy5lbnYsXCJOUE1DSV9TU0hLRVlfKlwiLGV2YWx1YXRlU3Noa2V5KTtcbiAgICBzc2hJbnN0YW5jZS53cml0ZVRvRGlzaygpO1xufTtcblxuZXhwb3J0IGxldCBldmFsdWF0ZVNzaGtleSA9IChzc2hrZXlFbnZWYXJBcmcpID0+IHtcbiAgICBsZXQgcmVzdWx0QXJyYXkgPSBzc2hSZWdleC5leGVjKHNzaGtleUVudlZhckFyZyk7XG4gICAgbGV0IHNzaEtleSA9IG5ldyBwbHVnaW5zLnNtYXJ0c3NoLlNzaEtleSgpO1xuICAgIFxuICAgIGlmKHJlc3VsdEFycmF5WzFdICYmIHJlc3VsdEFycmF5WzFdICE9IFwidW5kZWZpbmVkXCIpIHNzaEtleS5wcml2S2V5QmFzZTY0ID0gcmVzdWx0QXJyYXlbMV07XG4gICAgbGV0IHB1YmxpY0tleTpzdHJpbmc7XG4gICAgaWYocmVzdWx0QXJyYXlbMl0gJiYgcmVzdWx0QXJyYXlbMl0gIT0gXCJ1bmRlZmluZWRcIikgc3NoS2V5LnB1YktleUJhc2U2NCA9IHJlc3VsdEFycmF5WzJdO1xuICAgIGxldCBob3N0OnN0cmluZztcbiAgICBpZihyZXN1bHRBcnJheVszXSAmJiByZXN1bHRBcnJheVszXSAhPSBcInVuZGVmaW5lZFwiKSBzc2hLZXkuaG9zdCA9IHJlc3VsdEFycmF5WzFdO1xuICAgIFxuICAgIHNzaEluc3RhbmNlLmFkZEtleShzc2hLZXkpO1xufTsiXX0=
