"use strict";
require("typings-global");
var plugins = require("./npmci.plugins");
var sshRegex = /^(.*)\|?(.*)\|?(.*)/;
var sshInstance;
exports.ssh = function () {
    sshInstance = new plugins.smartssh.SshInstance();
    plugins.smartparam.forEachMinimatch(process.env, "NPMCI_SSHKEY_*", exports.evaluateSshkey);
    sshInstance.writeToDisk();
};
exports.evaluateSshkey = function (sshkeyEnvVarArg) {
    var resultArray = sshRegex.exec(sshkeyEnvVarArg);
    var sshKey = new plugins.smartssh.SshKey();
    if (resultArray[1] && resultArray[1] != "undefined")
        sshKey.privateKeyBase64 = resultArray[1];
    var publicKey;
    if (resultArray[2] && resultArray[2] != "undefined")
        sshKey.publicKeyBase64 = resultArray[2];
    var host;
    if (resultArray[3] && resultArray[3] != "undefined")
        sshKey.host = resultArray[1];
    sshInstance.addKey(sshKey);
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5wbWNpLnNzaC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsUUFBTyxnQkFBZ0IsQ0FBQyxDQUFBO0FBQ3hCLElBQVksT0FBTyxXQUFNLGlCQUFpQixDQUFDLENBQUE7QUFFM0MsSUFBSSxRQUFRLEdBQUcscUJBQXFCLENBQUE7QUFDcEMsSUFBSSxXQUF3QyxDQUFDO0FBRWxDLFdBQUcsR0FBRztJQUNiLFdBQVcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDakQsT0FBTyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFDLGdCQUFnQixFQUFDLHNCQUFjLENBQUMsQ0FBQztJQUNqRixXQUFXLENBQUMsV0FBVyxFQUFFLENBQUM7QUFDOUIsQ0FBQyxDQUFDO0FBRVMsc0JBQWMsR0FBRyxVQUFDLGVBQWU7SUFDeEMsSUFBSSxXQUFXLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUNqRCxJQUFJLE1BQU0sR0FBRyxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7SUFFM0MsRUFBRSxDQUFBLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxXQUFXLENBQUM7UUFBQyxNQUFNLENBQUMsZ0JBQWdCLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzdGLElBQUksU0FBZ0IsQ0FBQztJQUNyQixFQUFFLENBQUEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLFdBQVcsQ0FBQztRQUFDLE1BQU0sQ0FBQyxlQUFlLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVGLElBQUksSUFBVyxDQUFDO0lBQ2hCLEVBQUUsQ0FBQSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksV0FBVyxDQUFDO1FBQUMsTUFBTSxDQUFDLElBQUksR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFakYsV0FBVyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMvQixDQUFDLENBQUMiLCJmaWxlIjoibnBtY2kuc3NoLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFwidHlwaW5ncy1nbG9iYWxcIjtcbmltcG9ydCAqIGFzIHBsdWdpbnMgZnJvbSBcIi4vbnBtY2kucGx1Z2luc1wiO1xuXG5sZXQgc3NoUmVnZXggPSAvXiguKilcXHw/KC4qKVxcfD8oLiopL1xubGV0IHNzaEluc3RhbmNlOnBsdWdpbnMuc21hcnRzc2guU3NoSW5zdGFuY2U7XG5cbmV4cG9ydCBsZXQgc3NoID0gKCkgPT4ge1xuICAgIHNzaEluc3RhbmNlID0gbmV3IHBsdWdpbnMuc21hcnRzc2guU3NoSW5zdGFuY2UoKTtcbiAgICBwbHVnaW5zLnNtYXJ0cGFyYW0uZm9yRWFjaE1pbmltYXRjaChwcm9jZXNzLmVudixcIk5QTUNJX1NTSEtFWV8qXCIsZXZhbHVhdGVTc2hrZXkpO1xuICAgIHNzaEluc3RhbmNlLndyaXRlVG9EaXNrKCk7XG59O1xuXG5leHBvcnQgbGV0IGV2YWx1YXRlU3Noa2V5ID0gKHNzaGtleUVudlZhckFyZykgPT4ge1xuICAgIGxldCByZXN1bHRBcnJheSA9IHNzaFJlZ2V4LmV4ZWMoc3Noa2V5RW52VmFyQXJnKTtcbiAgICBsZXQgc3NoS2V5ID0gbmV3IHBsdWdpbnMuc21hcnRzc2guU3NoS2V5KCk7XG4gICAgXG4gICAgaWYocmVzdWx0QXJyYXlbMV0gJiYgcmVzdWx0QXJyYXlbMV0gIT0gXCJ1bmRlZmluZWRcIikgc3NoS2V5LnByaXZhdGVLZXlCYXNlNjQgPSByZXN1bHRBcnJheVsxXTtcbiAgICBsZXQgcHVibGljS2V5OnN0cmluZztcbiAgICBpZihyZXN1bHRBcnJheVsyXSAmJiByZXN1bHRBcnJheVsyXSAhPSBcInVuZGVmaW5lZFwiKSBzc2hLZXkucHVibGljS2V5QmFzZTY0ID0gcmVzdWx0QXJyYXlbMl07XG4gICAgbGV0IGhvc3Q6c3RyaW5nO1xuICAgIGlmKHJlc3VsdEFycmF5WzNdICYmIHJlc3VsdEFycmF5WzNdICE9IFwidW5kZWZpbmVkXCIpIHNzaEtleS5ob3N0ID0gcmVzdWx0QXJyYXlbMV07XG4gICAgXG4gICAgc3NoSW5zdGFuY2UuYWRkS2V5KHNzaEtleSk7XG59OyJdfQ==
